---
title: "Alaskan Catch of BC Salmon"
format: html
editor: visual
project:
  type: website
  output-dir: docs
editor_options:
  chunk_output_type: console
execute:
  echo: false
  warning: false
  message: false
---

```{r}
library(data.table)
library(tidyverse)
library(ggpubr)
library(RColorBrewer)
library(grid)
library(gridExtra)
library(readxl)
library(patchwork)
```

```{r source SEAK scripts with functions}
source("R/harvest_and_value_byspecies.R")
source("R/region1_catchbyarea.R")
source("R/catch_statweek.R")

```

```{r read in all data}
skeena.sx.trtc<-fread("data-raw/sockeye/sockeye-skeena-trtc data.csv")
nass.sx.trtc<-fread("data-raw/sockeye/sockeye-nass-trtc data.csv")

harvests<-fread("data-raw/SEAK_catch/SEAK D101-D106 harvest by district by week.csv")

catch <- read.csv("data-raw/SEAK_catch/Alaska Statewide Salmon Landings by Area and Species 1985-present Fish Tickets.csv")

value <- read.csv("data-raw/SEAK_catch/ADFG AK Harvest and Vaue 1980 2022.csv")

bluesheet <- read.csv("data-raw/SEAK_catch/Alaska Statewide Salmon Landings by Area and Species 1985-present Fish Tickets.csv")

```

# Summary

# Southeast Alaska Catch of BC Salmon

### Fishing areas in Southeast Alaska
```{r include-jpeg, echo=FALSE, fig.cap = "Map of Southeast Alaska Fishing Areas by District.", out.width='70%'}
#| label: fig-seak-map
knitr::include_graphics("figure1-map.jpeg")

```

### Total salmon harvest in Southeast Alaska fisheries by year and species

```{r fig-harvest-species, fig.height=5, fig.cap="Southeast Alaska, US (SEAK) total harvest in millions of fish by species for each year for 1979-2021."}
make.harvest.byspecies(catch)
```

### Total salmon harvest and total value in Southeast Alaska fisheries by year and species
```{r fig-seak-value, fig.height=10, fig.cap= "Southeast Alaska, US (SEAK) harvest (millions of fish) and value (millions of US Dollars) by species from 1985-2023."}
make.harvest.value.byspecies(value, catch)
```

### 2023 Southeast Alaska harvest by statistical week, broken down by district, species, and gear type
```{r fig-catch-statweek, fig.height=6, fig.cap="Harvest by species, gear type, district, and statistical week."}
make.catch.statweek.plot(harvests)
```

# Sockeye

```{r source sockeye scripts}
source("R/sockeye/sockeye_catch_bydistrict.R")
source("R/sockeye/sockeye_marine_catch_plots.R")
source("R/sockeye/sockeye_prop_week31.R")
source("R/sockeye/sockeye_er_sa.R")
source("R/sockeye/sockeye_ers_area5.R")
source("R/sockeye/sockeye_stockcomp_d101104.R")
source("R/sockeye/sockeye_fr_catch.R")
source("R/sockeye/sockeye_fr_stockcomps.R")

source("R/sockeye/skeena-sockeye-trtc-cu-akers.R")
source("R/sockeye/nass-sockeye-trtc-cu-akers.R")
```

```{r read sockeye data}
sk_harv <- read.csv("data-raw/SEAK_catch/SEAK D101-D106 harvest by district by week.csv") 

pre.sn<-read.csv("data-raw/D104 pre 31 versus total.csv", check.names = FALSE)  

sn<-read.csv("data-raw/skeena nass ak fishery ers.csv",header=TRUE,
             check.names = FALSE)

sa.data<-read.csv("data-raw/NCConlystatareadata.csv")

data<-read.csv("data-raw/2022-01-10d101.104GSI2006_2018.csv")

regions<-read.csv("data-raw/CatchByRegion2023.csv") 

stockgroups <- read.csv("data-raw/D104_AnnualCatchByStockGroup.csv", check.names=FALSE) 

```

```{r fig-sx-catch-bydistrict, fig.height=6, fig.cap="Total catch of sockeye salmon by year for SSEAK Districts 101-106 (1985-2021). Smoothed lines are derived by LOESS with standard errors shown in grey."}
make.catch.bydistrict(sk_harv)
```

```{r fig-sk-marine-catch, fig.height=5, fig.cap="Canadian and US Skeena sockeye harvest (1960-2023)."}
make.sk.marine.catch.plot(skeena.sx.trtc)
```

```{r fig-nass-marine-catch, fig.height=5, fig.cap="Canadian and US Nass sockeye harvest (1980-2023)."}
make.nass.marine.catch.plot(nass.sx.trtc)
```

```{r fig-pre-sk, fig.height=5, fig.cap="Proportion of total D104 catch harvested before Week 31 for Skeena sockeye salmon."}
make.prop.week31.sk(pre.sn)
```

```{r fig-pre-nass, fig.height=5, fig.cap = "Proportion of total D104 catch harvested before Week 31 for Nass sockeye salmon."}
make.prop.week31.nass(pre.sn)
```

```{r fig-ers-subarea, fig.height=6, fig.cap="SEAK exploitation rate on Skeena and Nass sockeye by SEAK fishing sub-area."}
make.ers.sub.area(sn)
```

```{r fig-ers-area5, fig.height=5, fig.cap="Canadian and SEAK exploitation rates on Area 5 sockeye, 1960 to 2017."}
make.ers.area5(sa.data)
```

```{r fig-stockcomp, fig.height=8, fig.cap="Weekly stock composition of sockeye in the District 101 commercial gillnet and 104 commercial purse seine fisheries for 2016-2018. Estimates are based on genetic stock ID."}
make.stockcomp.d101104(data)
```

```{r fig-catch-byregion, fig.height=8, fig.cap="Canadian (green), Alaskan (red) and Washington (green) catch (top panel), exploitation rate (middle panel) and percent of catch (bottom panel) for Fraser River sockeye from 2000-2022."}
make.fr.catch.plot(regions)
```

```{r fig-fr-stockcomps, fig.height=6, fig.cap="Stock composition by Conservation Unit for Fraser sockeye catch from 2000-2021."}
make.stockcomp.fr(stockgroups)
```

## Skeena
-   Alaskan fisheries catch all species of salmon in the Skeena
-   Catch of Skeena sockeye is estimated through the Northern Boundary Run Reconstruction Model and can be very high in some years, especially on late timed populations

Information on Alaskan exploitation of Skeena sockeye comes primarily from the Northern Boundary Sockeye Run Reconstruction model, which uses estimated run-timing and migration route to provide estimates of interception rates in Alaska fisheries. We show time-series of Alaskan exploitation rates for each Skeena sockeye Conservation Unit with information (@fig-skeena-trtc1) and the distribution of exploitation rates (@fig-skeena-trtc2).

```{r fig-skeena-trtc1, fig.height=10,fig.cap="Alaskan exploitation rates for each Skeena sockeye Conservation Unit (1960-2023)."}

make.skeena.trtc.lineplot(skeena.sx.trtc)

```

```{r fig-skeena-trtc2,fig.height=8,fig.cap="Distribution of Alaskan exploitation rates on each Skeena sockeye CU with information (1960-2023)."}

make.skeena.trtc.boxplot(skeena.sx.trtc)

```

## Nass
Information on Alaskan exploitation of Nass sockeye comes primarily from the Northern Boundary Sockeye Run Reconstruction model, which uses estimated run-timing and migration route to provide estimates of interception rates in Alaska fisheries. We show timeseries of Alaskan exploitation rates for each Nass sockeye Conservation Unit with information (@fig-nass-trtc1) and the distribution of exploitation rates by CU (@fig-nass-trtc2).

```{r fig-nass-trtc1,fig.height=5,fig.cap="Alaskan exploitation on Nass sockeye by CU."}

make.nass.trtc.lineplot(nass.sx.trtc)
```

```{r fig-nass-trtc2,fig.cap="Distribution of Alaskan exploitation rates on each Nass sockeye CU with information (1960-2023)."}

make.nass.trtc.boxplot(nass.sx.trtc)
```

```{r fig-sk-bs-fishery, fig.height=8, fig.cap= "Southeast Alaska, US (SEAK) harvest of Sockeye by fishery between 1980 and 2024. Note that the y-axis scales are scaled by individual facet."}
make.sockeye.bluesheet(bluesheet)
```

# Chinook 
```{r source chinook scripts}
source("R/chinook/chinook_bluesheet_catch.R")
source("R/chinook/chinook_catch_bydistrict.R")
source("R/chinook/chinook_exploitation_sa.R")
source("R/chinook/chinook_er_cu.R")
source("R/chinook/chinook_seak_er_ctc.R")
```

```{r read chinook data}
data <-read.csv("data-raw/2021-12-12_1980-2020 SE Harvest BY Fishery_LONG.csv", check.names = FALSE)

districts<-read.csv("data-raw/SEAK harvest by district 85-21.csv", check.names = FALSE)

sa.data<-fread("data-raw/NCConlystatareadata.csv")

seak_er<-fread("data-raw/NC_TRTC_2019_04_04.txt")

cn_new <- fread("data-raw/chinook/cn_all_mort_new2025.csv")

```

```{r fig-cn-boxplot, fig.height=6, fig.cap="Distribution of total Chinook salmon commercial catch in SEAK Blue Sheet fisheries from 1980-2021."}
make.cn.blusheet.box(data)
```

```{r fig-cn-catch-bydistrict, fig.height=6, fig.cap = "Total catch of Chinook salmon by year for SSEAK Districts 101-106 (1985-2021). Smoothed lines are derived by LOESS with standard errors shown in grey."}

make.cn.districts.plot(districts)
```

```{r fig-cn-er-statarea, fig.height=8, fig.cap="SEAK (red) and Canadian (blue) exploitation rates by year for north and central coast (Statistical Areas 1-10) Chinook salmon from 1985-2017. Source: LGL 2021a."}
make.cn.ers.plot(sa.data)
```

```{r fig-cn-er-cu, fig.height=8, fig.cap="SEAK exploitation rates for Chinook salmon from north and central coast Conservation Units from 1954-2017. Trend lines derived using LOESS in R. Source: PSF 2021."}

make.cn.er.cu(seak_er)
```

```{r fig-cn-seak-ctc, fig.height=8, fig.cap="Total SEAK exploitation rates for Canadian (excluding Transboundary stocks) CTC indicator stocks by year (1979-2023). Trend lines derived using LOESS in R. Source: PSC CTC 2025."}
make.cn.seak.ctc(cn_new)
```

```{r fig-cn-bs-fishery, fig.height=8, fig.cap= "Southeast Alaska, US (SEAK) harvest of Chinook by fishery between 1980 and 2024. Note that the y-axis scales are scaled by individual facet."}
make.chinook.bluesheet(bluesheet)
```

# Coho
```{r source coho scripts}
source("R/coho/coho_seak_cdn_ers.R")
source("R/coho/coho-seak-er-cu.R")
source("R/coho/coho_zolzap_ers.R")
```

```{r coho data}
data<-fread("data-raw/NC_TRTC_2019_04_04.txt")
zz<-fread("data-raw/zolzap ers.csv")

```

```{r fig-co-ers, fig.height=8, fig.cap = "SEAK (red) and Canadian (blue) exploitation rates by year for north and central coast (Statistical Areas 1-10) coho salmon from 1954-2017. Source: LGL 2021a."}
make.co.ers.plot(sa.data)
```


```{r fig-co-seak-er-cu, fig.height=8, fig.cap="SEAK exploitation rates for coho salmon from north and central coast Conservation Units from 1954- 2017. Trend lines derived using LOESS in R. Source: PSF 2021."}
make.co.seak.ers(data)
```

```{r fig-co-zz-ers, fig.height=6, fig.cap ="CDN (blue) and SEAK (red) exploitation rates (above) and the percent of SEAK harvest (below) for Zolzap Creek coho. Source: LGL 2021b, Noble et al. 2020."}
make.co.zz.plot(zz)
```


```{r include-jpeg, echo=FALSE, fig.cap = "Recovery patterns of coded-wire tagged coho salmon (Oncorhynchus kisutch) by hatchery. Each bar provides the percent of recoveries in the 21 recovery areas for a single hatchery. The geographic region of hatcheries is indicated. Source: Weitkamp and Neely (2011).", out.width='70%'}
#| label: fig-coho-recovery
knitr::include_graphics("coho_recovery.jpeg")

```

```{r fig-co-bs-fishery, fig.height=8, fig.cap= "Southeast Alaska, US (SEAK) harvest of Coho by fishery between 1980 and 2024. Note that the y-axis scales are scaled by individual facet."}
make.coho.bluesheet(bluesheet)
```

# Chum

```{r source chum scripts}
source("R/chum/chum_seak_harvest.R")
source("R/chum/chum_seak_bydistrict.R")
source("R/chum/chum_seak_cdn_ers_sa.R")
source("R/chum/chum_seak_er_bycu.R")
```

```{r chum data}
harv<-fread("data-raw/SEAK_catch/ADFG AK Harvest and Vaue 1980 2022.csv")
data<-fread("data-raw/SEAK harvest by district 85-21.csv")
er_cu<-fread("data-raw/NC_TRTC_2019_04_04.txt")
```

```{r fig-chum-seakharv, fig.height=6, fig.cap="Total SEAK harvest (millions of fish) of chum salmon from 1980-2022."}
make.chum.harv.plot(harv)
```

```{r fig-chum-seak-district, fig.height=6, fig.cap="Total catch of chum salmon by year for SSEAK Districts 101-106 (1985-2021). Smoothed lines are derived by LOESS with standard errors shown in grey. Source: ADFG 2021d."}
make.chum.harv.bydist(data)
```

```{r fig-chum-ers-sa, fig.height=8, fig.cap="SEAK (red) and Canadian (blue) exploitation rates by year for north and central coast (Statistical Areas 1-10) chum salmon from 1954-2017. Source: PSF 2021."}
make.chum.ers.sa(sa.data)
```

```{r fig-chum-seak-er-cu, fig.height=8, fig.cap="Canadian and SEAK exploitation rates for chum salmon from north and central coast Conservation Units from 1954- 2017. Trend lines derived using LOESS in R. Source: PSF 2021."}
chum.seak.er.cu(er_cu)
```


```{r fig-cm-bs-fishery, fig.height=8, fig.cap= "Southeast Alaska, US (SEAK) harvest of Chum by fishery between 1980 and 2024. Note that the y-axis scales are scaled by individual facet."}
make.chum.bluesheet(bluesheet)
```

# Pink
```{r source pink scripts}
source("R/pink/pink_seak_harv.R")
source("R/pink/pink_seak_harv_dist.R")
source("R/pink/pinkeven_ers_sa.R")
source("R/pink/pinkodd_ers_sa.R")
source("R/pink/pink_seak_er_cu.R")
```

```{r pink data}
data<-fread("data-raw/SEAK harvest by district 85-21.csv")

```

```{r fig-pink-seak-harv, fig.height=6, fig.cap="SEAK catch (millions of fish) of pink salmon from 1979-2021. Source: ADFG 2021a (1979-2020), ADFG 2021b (2021)."}
make.pink.harv(harv)
```

```{r fig-pink-seak-harv-dist, fig.height=6, fig.cap="Total catch of pink salmon by year for SSEAK Districts 101-106 (1985-2021). Smoothed lines are derived by LOESS with standard errors shown in grey. Source: ADFG 2021d."}
pink.seak.harv.bydistrict(data)
```

```{r fig-pink-ers-sa, fig.height=8, fig.cap="SSEAK (red) and Canadian (blue) exploitation rates by year for north and central coast (Statistical Areas 1-10) even-year pink salmon from 1954-2017. Source: PSF 2021."}
make.pink.ers.sa(sa.data)
```

```{r fig-pinkodd-ers-sa, fig.height=8, fig.cap="SSEAK (red) and Canadian (blue) exploitation rates by year for north and central coast (Statistical Areas 1-10) odd-year pink salmon from 1954-2017. Source: PSF 2021."}
make.pink.odd.ers.sa(sa.data)
```

```{r fig-pink-seak-er-cu, fig.height=8, fig.cap="SSEAK exploitation rates for even (red points) and odd (blue points) year pink salmon from north and central coast Conservation Units from 1954-2017. Trend lines derived using LOESS in R. Source: PSF 2021."}
pink.seak.er.cu(er_cu)
```

```{r fig-pk-bs-fishery, fig.height=8, fig.cap= "Southeast Alaska, US (SEAK) harvest of Pink Salmon by fishery between 1980 and 2024. Note that the y-axis scales are scaled by individual facet."}
make.pink.bluesheet(bluesheet)
```


# Transboundary
```{r read TBR data}
d106 <- read_excel("data-raw/TBR/TBR data_updated2023.xlsx", sheet="TBR.106.harvest")
d108 <- read_excel("data-raw/TBR/TBR data_updated2023.xlsx", sheet="TBR.106.harvest")
d111 <- read_excel("data-raw/TBR/TBR data_updated2023.xlsx", sheet="TBR.D111harvest")

stikine.cn<-read_excel("data-raw/TBR/TBR data_updated2023.xlsx", sheet="TBR.stikine.chinook.rr")

```

```{r source TBR scripts}
source("R/TBR_106_108_catch.R")
source("R/TBR_111_gncatch.R")
source("R/TBR_stikine_chinook.R")

```

```{r fig-tbr-106108-catch, fig.height=8, fig.cap="SEAK catch of all salmon species in Districts 106 and 108, 1960-2023."}
make.tbr.106108.catch(d106, d108)
```

```{r fig-tbr-111-gncatch, fig.height=8, fig.cap="SEAK commercial gillnet catch of all salmon species in District 111, 1960-2023."}
make.tbr.d111.gncatch(d111)
```

```{r fig-stikine-chinook, fig.height=8, fig.cap="Stikine River Chinook salmon Canadian harvest, US harvest, and escapement (top panel), Canadian vs US harvest (middle panel), and Canadian and US percent of total harvest (bottom panel), 1996-2023."}
make.stikine.cn.plot(stikine.cn)
```
# Steelhead

## Appendix 1: Pacific Salmon Commission Chinook Technical Committee Mortality Distribution Tables
